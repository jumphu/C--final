# 碰撞测试文档

## ?? 测试文件说明

`test_collision.cpp` 是一个全面的碰撞系统测试程序，用于验证物理引擎中不同形状之间的碰撞响应。

## ?? 测试覆盖的内容

### 测试1: Circle vs Circle 碰撞
- **场景**: 两个相等质量的圆形正面对撞
- **验证**: 完全弹性碰撞时速度交换
- **物理原理**: 动量守恒和能量守恒

### 测试2: 不同质量的圆形碰撞
- **场景**: 重球(质量10)撞击轻球(质量1)
- **验证**: 重物速度变化小，轻物速度变化大
- **物理原理**: 动量守恒，质量差异影响

### 测试3: AABB vs AABB 碰撞
- **场景**: 两个矩形水平碰撞
- **验证**: 矩形碰撞的正确分离和速度变化
- **物理原理**: 沿碰撞法向量的冲量传递

### 测试4: Circle vs AABB 碰撞
- **场景**: 圆形撞击矩形
- **验证**: 不同形状之间的碰撞响应
- **物理原理**: 混合形状碰撞检测和响应

### 测试5: 不同弹性系数的碰撞对比
- **场景**: 对比三种弹性系数 (1.0, 0.5, 0.0)
- **验证**: 弹性系数对碰撞结果的影响
- **物理原理**: 恢复系数决定能量损失

### 测试6: 连续碰撞模拟
- **场景**: 三个球的连锁碰撞
- **验证**: 多次碰撞的正确性
- **物理原理**: 时间步进和连续碰撞处理

## ?? 编译方法

### 方法1: 使用 g++ 命令行编译

```bash
# 在项目根目录下执行
g++ -std=c++11 -o test_collision.exe ^
    tests/test_collision.cpp ^
    src/shapes.cpp ^
    src/physicalWorld.cpp ^
    -I include
```

### 方法2: 使用 Visual Studio

1. 在 Visual Studio 中打开解决方案
2. 添加新的控制台应用项目 "TestCollision"
3. 添加以下文件：
   - `tests/test_collision.cpp`
   - `src/shapes.cpp`
   - `src/physicalWorld.cpp`
4. 包含目录添加：`include`
5. 编译并运行

### 方法3: 使用 CMake (推荐)

创建 `CMakeLists.txt`:

```cmake
cmake_minimum_required(VERSION 3.10)
project(PhysicsTests)

set(CMAKE_CXX_STANDARD 11)

# 添加测试可执行文件
add_executable(test_collision
    tests/test_collision.cpp
    src/shapes.cpp
    src/physicalWorld.cpp
)

# 包含目录
target_include_directories(test_collision PRIVATE include)
```

然后编译：
```bash
mkdir build
cd build
cmake ..
cmake --build .
./test_collision
```

## ?? 运行测试

编译成功后，直接运行可执行文件：

```bash
# Windows
test_collision.exe

# Linux/Mac
./test_collision
```

## ?? 预期输出

测试程序会输出详细的测试信息，包括：

```
========================================
  测试1: Circle vs Circle 碰撞
========================================

场景：两个圆形正面对撞
圆1从左向右运动，圆2从右向左运动

碰撞前状态：
圆1:
  位置: (0.00, 0.00)
  速度: (5.00, 0.00)
  质量: 1.00
  弹性系数: 1.00
圆2:
  位置: (6.00, 0.00)
  速度: (-5.00, 0.00)
  质量: 1.00
  弹性系数: 1.00

? 检测到碰撞！

碰撞后状态：
圆1:
  位置: (0.00, 0.00)
  速度: (-5.00, 0.00)
  质量: 1.00
  弹性系数: 1.00
...
? 测试通过！
```

## ?? 物理原理参考

### 弹性碰撞公式

对于一维弹性碰撞：

```
v1' = ((m1 - m2)v1 + 2m2*v2) / (m1 + m2)
v2' = ((m2 - m1)v2 + 2m1*v1) / (m1 + m2)
```

### 弹性系数影响

恢复系数 e 的定义：
```
e = -(v2' - v1') / (v2 - v1)
```

- e = 1.0: 完全弹性碰撞（能量守恒）
- 0 < e < 1: 部分弹性碰撞（能量部分损失）
- e = 0.0: 完全非弹性碰撞（最大能量损失）

## ?? 调试技巧

如果测试失败，检查以下几点：

1. **碰撞检测**: 确保 `check_collision()` 正确识别碰撞
2. **法向量计算**: 验证碰撞法向量是否正确归一化
3. **冲量计算**: 检查 `impulseScalar` 的计算是否正确
4. **分离逻辑**: 确保重叠物体被正确分离

## ?? 扩展测试

你可以在此基础上添加更多测试：

1. **斜向碰撞**: 非正面碰撞的情况
2. **高速碰撞**: 测试数值稳定性
3. **静止碰撞**: 物体叠加在一起的初始状态
4. **旋转碰撞**: 如果添加了旋转功能

## ?? 相关文件

- `include/shapes.h` - 形状定义
- `src/shapes.cpp` - 形状实现
- `include/physicalWorld.h` - 物理世界定义
- `src/physicalWorld.cpp` - 碰撞处理实现

## ? 成功标志

如果所有测试通过，你会看到：

```
??? 所有碰撞测试完成！ ???
```

这表示你的碰撞系统工作正常！
